generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String?
  createdAt     DateTime       @default(now())
  name          String?
  landlord      Landlord?
  notifications Notification[]
  tenant        Tenant?
  userRoles     UserRole[]
}

model UserRole {
  id         String    @id @default(uuid())
  userId     String
  role       Role
  landlordId String?
  createdAt  DateTime  @default(now())
  landlord   Landlord? @relation(fields: [landlordId], references: [id])
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([landlordId])
}

model Landlord {
  id                  String               @id @default(uuid())
  userId              String               @unique
  name                String
  contactPhone        String?
  defaultCurrency     String               @default("INR")
  createdAt           DateTime             @default(now())
  bills               Bill[]
  documents           Document[]
  inviteTokens        InviteToken[]
  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  maintenanceRequests MaintenanceRequest[]
  paymentReminders    PaymentReminder[]
  properties          Property[]
  tenancies           Tenancy[]
  tenants             Tenant[]
  userRoles           UserRole[]

  @@index([userId])
}

model Tenant {
  id                       String               @id @default(uuid())
  userId                   String               @unique
  fullName                 String
  address                  String?
  createdAt                DateTime             @default(now())
  policeVerificationNumber String?
  policeVerificationDate   DateTime?
  landlordId               String
  dateOfBirth              DateTime?
  email                    String?
  emergencyContact         String?
  emergencyContactPhone    String?
  idNumber                 String?
  idType                   String?
  moveInDate               DateTime?
  occupation               String?
  phone                    String?
  workplace                String?
  bills                    Bill[]
  documents                Document[]
  inviteTokens             InviteToken[]
  maintenanceRequests      MaintenanceRequest[]
  paymentReminders         PaymentReminder[]
  tenancies                Tenancy[]
  landlord                 Landlord             @relation(fields: [landlordId], references: [id])
  user                     User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([landlordId])
}

model Property {
  id                  String               @id @default(uuid())
  landlordId          String
  address             String
  description         String?
  createdAt           DateTime             @default(now())
  status              String               @default("VACANT")
  activityLogs        ActivityLog[]
  bills               Bill[]
  documents           Document[]
  inviteTokens        InviteToken[]
  maintenanceRequests MaintenanceRequest[]
  landlord            Landlord             @relation(fields: [landlordId], references: [id])
  tenancies           Tenancy[]
}

model Tenancy {
  id              String      @id @default(uuid())
  tenantId        String
  propertyId      String
  leaseStart      DateTime
  leaseEnd        DateTime?
  status          LeaseStatus
  securityDeposit Decimal     @db.Decimal(10, 2)
  createdAt       DateTime    @default(now())
  endedAt         DateTime?
  currency        String      @default("USD")
  landlordId      String
  monthlyRent     Decimal     @db.Decimal(10, 2)
  bills           Bill[]
  documents       Document[]
  landlord        Landlord    @relation(fields: [landlordId], references: [id])
  property        Property    @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant          Tenant      @relation(fields: [tenantId], references: [id])

  @@index([landlordId])
  @@index([tenantId])
  @@index([propertyId])
}

model Bill {
  id               String            @id @default(uuid())
  tenantId         String
  propertyId       String
  dueDate          DateTime
  status           PaymentStatus
  createdAt        DateTime          @default(now())
  currency         String            @default("INR")
  landlordId       String
  tenancyId        String
  carryForward     Decimal           @default(0) @db.Decimal(10, 2)
  electricityRate  Decimal?          @db.Decimal(10, 2)
  electricityTotal Decimal?          @db.Decimal(10, 2)
  electricityUnits Int?
  month            DateTime
  note             String?
  paidAmount       Decimal           @default(0) @db.Decimal(10, 2)
  remainingAmount  Decimal           @db.Decimal(10, 2)
  rent             Decimal           @db.Decimal(10, 2)
  totalBill        Decimal           @db.Decimal(10, 2)
  updatedAt        DateTime          @updatedAt
  waterBill        Decimal?          @db.Decimal(10, 2)
  editedAt         DateTime?
  isEdited         Boolean           @default(false)
  landlord         Landlord          @relation(fields: [landlordId], references: [id])
  property         Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenancy          Tenancy           @relation(fields: [tenancyId], references: [id], onDelete: Cascade)
  tenant           Tenant            @relation(fields: [tenantId], references: [id])
  documents        Document[]
  ledgerEntries    LedgerEntry[]
  payments         Payment[]
  paymentReminders PaymentReminder[]

  @@unique([tenancyId, month])
  @@index([landlordId])
  @@index([tenancyId])
  @@index([tenantId])
  @@index([propertyId])
  @@index([month])
}

model Payment {
  id                String    @id @default(uuid())
  billId            String
  amount            Decimal   @db.Decimal(10, 2)
  paidAt            DateTime
  confirmedAt       DateTime?
  paymentProof      String?
  paymentMethod     String?
  note              String?
  createdAt         DateTime  @default(now())
  correctionReason  String?
  isCorrection      Boolean   @default(false)
  originalPaymentId String?
  verifiedAt        DateTime?
  verifiedByTenant  Boolean   @default(false)
  bill              Bill      @relation(fields: [billId], references: [id], onDelete: Cascade)

  @@index([billId])
  @@index([paidAt])
}

model LedgerEntry {
  id                         String    @id @default(uuid())
  billId                     String
  entryDate                  DateTime
  description                String
  debitAmount                Decimal?  @db.Decimal(10, 2)
  creditAmount               Decimal?  @db.Decimal(10, 2)
  verifiedByTenant           Boolean   @default(false)
  verifiedAt                 DateTime?
  createdBy                  String
  createdAt                  DateTime  @default(now())
  updatedAt                  DateTime  @updatedAt
  paymentMethod              String?
  paymentProof               String?
  editedAt                   DateTime?
  electricityRate            Decimal?  @db.Decimal(10, 2)
  electricityTotal           Decimal?  @db.Decimal(10, 2)
  isEdited                   Boolean   @default(false)
  rentAmount                 Decimal?  @db.Decimal(10, 2)
  waterBill                  Decimal?  @db.Decimal(10, 2)
  electricityCurrentReading  Int?
  electricityPreviousReading Int?
  electricityUnitsConsumed   Int?
  bill                       Bill      @relation(fields: [billId], references: [id], onDelete: Cascade)

  @@index([billId])
  @@index([entryDate])
}

model Document {
  id           String    @id @default(uuid())
  tenantId     String?
  billId       String?
  fileUrl      String
  landlordId   String
  tenancyId    String?
  category     String?
  description  String?
  documentDate DateTime?
  documentName String
  fileSize     Int?
  mimeType     String?
  propertyId   String
  uploadedAt   DateTime  @default(now())
  bill         Bill?     @relation(fields: [billId], references: [id], onDelete: Cascade)
  landlord     Landlord  @relation(fields: [landlordId], references: [id], onDelete: Cascade)
  property     Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenancy      Tenancy?  @relation(fields: [tenancyId], references: [id], onDelete: Cascade)
  tenant       Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([landlordId])
  @@index([propertyId])
}

model PaymentReminder {
  id             String         @id @default(uuid())
  landlordId     String
  billId         String
  tenantId       String
  status         ReminderStatus
  reminderSentAt DateTime?
  createdAt      DateTime       @default(now())
  bill           Bill           @relation(fields: [billId], references: [id])
  landlord       Landlord       @relation(fields: [landlordId], references: [id])
  tenant         Tenant         @relation(fields: [tenantId], references: [id])

  @@index([landlordId])
  @@index([billId])
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  message   String
  read      Boolean          @default(false)
  sentAt    DateTime?
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id])

  @@index([userId])
}

model MaintenanceRequest {
  id              String            @id @default(uuid())
  landlordId      String
  tenantId        String?
  propertyId      String
  description     String
  status          MaintenanceStatus @default(requested)
  requestedAt     DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  createdAt       DateTime          @default(now())
  category        String?
  completedAt     DateTime?
  priority        String            @default("MEDIUM")
  resolutionNotes String?
  title           String
  landlord        Landlord          @relation(fields: [landlordId], references: [id])
  property        Property          @relation(fields: [propertyId], references: [id])
  tenant          Tenant?           @relation(fields: [tenantId], references: [id])

  @@index([landlordId])
  @@index([propertyId])
  @@index([status])
}

model ActivityLog {
  id          String   @id @default(uuid())
  propertyId  String
  type        String
  description String
  date        DateTime
  relatedId   String?
  createdAt   DateTime @default(now())
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([date])
  @@index([type])
}

model InviteToken {
  id         String    @id @default(uuid())
  token      String    @unique @default(uuid())
  email      String
  tenantId   String
  landlordId String
  propertyId String
  expiresAt  DateTime
  usedAt     DateTime?
  createdAt  DateTime  @default(now())
  landlord   Landlord  @relation(fields: [landlordId], references: [id])
  property   Property  @relation(fields: [propertyId], references: [id])
  tenant     Tenant    @relation(fields: [tenantId], references: [id])

  @@index([token])
  @@index([email])
}

enum Role {
  landlord
  tenant
  admin
}

enum DocumentType {
  rent_receipt
  verification
  statement
}

enum LeaseStatus {
  active
  ended
  pending
}

enum BillType {
  rent
  electricity
  water
  other
}

enum PaymentStatus {
  pending
  paid
  overdue
  cancelled
}

enum NotificationType {
  info
  warning
  error
  system
}

enum MaintenanceStatus {
  requested
  in_progress
  completed
  cancelled
}

enum ReminderStatus {
  pending
  sent
  failed
}

model WaitlistEntry {
  id          String    @id @default(uuid())
  email       String    @unique
  firstName   String
  emailSent   Boolean   @default(false)
  emailSentAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([email])
}
